

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.2. Building the Example Bundles &mdash; Ambry 0.3.2049 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Ambry 0.3.2049 documentation" href="../index.html"/>
        <link rel="up" title="2. Tutorials" href="index.html"/>
        <link rel="next" title="3. Process Reference" href="../process/index.html"/>
        <link rel="prev" title="2.1. Create a New Bundle" href="create_bundle.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Ambry
          

          
          </a>

          
            
            
              <div class="version">
                0.3.2049
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install_config/index.html">1. Install and Configure Ambry</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create_bundle.html">2.1. Basic bundle creation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.2. Building the example bundles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-the-source">2.2.1. Get the Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#import-the-example-bundles">2.2.2. Import the Example Bundles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-bambry-command">2.2.3. Using the Bambry Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-bundles">2.2.4. Build the Bundles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-your-work">2.2.5. Check your Work</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bundle-source">2.2.6. Bundle Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-tips">2.2.7. Other Tips</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">3. Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">4. Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">5. Concepts and Design Overview</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Ambry</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">2. Tutorials</a> &raquo;</li>
      
    <li>2.2. Building the Example Bundles</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/example_bundles.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-the-example-bundles">
<h1>2.2. Building the Example Bundles<a class="headerlink" href="#building-the-example-bundles" title="Permalink to this headline">¶</a></h1>
<p>The ambry source distribution has a set of example bundles that are useful for
learning how to use the ambry library. This tutorial will guide you through loading the example bundles into the library, building them, and exploring the results.</p>
<div class="section" id="get-the-source">
<h2>2.2.1. Get the Source<a class="headerlink" href="#get-the-source" title="Permalink to this headline">¶</a></h2>
<p>If you don&#8217;t already have the ambry source distribution:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone https://github.com/CivicKnowledge/ambry.git
$ <span class="nb">cd</span> ambry
$ git checkout ambry1.0
$ <span class="nb">cd</span> .. <span class="c1"># So the next step doesn&#39;t use the ambry module in this dir</span>
</pre></div>
</div>
</div>
<div class="section" id="import-the-example-bundles">
<h2>2.2.2. Import the Example Bundles<a class="headerlink" href="#import-the-example-bundles" title="Permalink to this headline">¶</a></h2>
<p>With the source available, import the bundle into the library, but use the &#8216;-d&#8217; option to detach the source. When the bundle source is later exported, it will be exported to the default source directory, not to the directory of the originally imported source. If you are a developer, this prevents the source tree from getting polluted with source files.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ambry import -d  ambry/test/bundles/
Loading bundle: example.com-simple-0.1.3~d000simple003
Loading bundle: example.com-segments-0.1.1~d0segments001
Loading bundle: example.com-process-0.1.3~d00process003
Loading bundle: example.com-generators-0.1.1~dgenerator001
Loading bundle: example.com-dimension-0.1.1~ddimension001
Loading bundle: example.com-complete-ref-0.1.3~d000000ref003
Loading bundle: example.com-complete-load-0.1.3~d00000load003
Loading bundle: example.com-complete-build-0.1.3~d0000build003
Loading bundle: example.com-casters-0.1.3~d00casters003
</pre></div>
</div>
<p>Now, you can list the bundles:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ambry list
vid            vid            vname                             state
-------------  -------------  --------------------------------  -------
d000simple003  d000simple003  example.com-simple-0.1.3          new
d0segments001  d0segments001  example.com-segments-0.1.1        new
d00process003  d00process003  example.com-process-0.1.3         new
dgenerator001  dgenerator001  example.com-generators-0.1.1      new
ddimension001  ddimension001  example.com-dimension-0.1.1       new
d000000ref003  d000000ref003  example.com-complete-ref-0.1.3    new
d00000load003  d00000load003  example.com-complete-load-0.1.3   new
d0000build003  d0000build003  example.com-complete-build-0.1.3  new
d00casters003  d00casters003  example.com-casters-0.1.3         new
</pre></div>
</div>
</div>
<div class="section" id="using-the-bambry-command">
<h2>2.2.3. Using the Bambry Command<a class="headerlink" href="#using-the-bambry-command" title="Permalink to this headline">¶</a></h2>
<p>You can operate on these bundles with the <a class="reference internal" href="../cli/bambry.html#bambry-command"><span class="std std-ref">bambry command</span></a> program. There are a few ways to
specify which bundle you want to work on:</p>
<ul class="simple">
<li>Use the <code class="docutils literal"><span class="pre">-i</span></code> option to specify the bundle vid explicity.</li>
<li><strong class="command">cd</strong> to the bundle directory.  <strong class="command">bambry</strong> will find a bundle ref in a <code class="file docutils literal"><span class="pre">bundle.yaml</span></code> file in the current directory</li>
<li>Set the <cite>AMBRY_BUNDLE</cite> env var.</li>
<li>For most commands, supply the vid as an argument.</li>
<li>Without any of the prior methods, <strong class="command">bambry</strong> will use the last bundle you worked on.</li>
</ul>
<p>Here are examples of all of the options:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> &lt;bundle_dir&gt;<span class="p">;</span> bambry info
$ <span class="nv">AMBRY_BUNDLE</span><span class="o">=</span>d00process003 bambry info
$ bambry -i d000simple003 info
$ bambry info d000simple003
$ bambry info
</pre></div>
</div>
<p>A common pattern is to use <cite>-i</cite> for the first operation, and after that, don&#8217;t specify anything, and <strong class="command">bambry</strong> will continue to use the prior bundle. If you want to see what bundle will be used if one isn&#8217;t specified, run <strong class="command">bambry info -w</strong></p>
<p>If the bundles were imported correctly, they should have some source or table records, which you can check with the <strong class="command">bambry dump</strong> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ bambry -i d000000ref003 dump -s
Dumping datasources <span class="k">for</span> example.com-complete-ref-0.1.3~d000000ref003

vid                  sequence_id  name    title    dest_table_name
-----------------  -------------  ------  -------  -----------------
S000000ref0001003              <span class="m">1</span>  simple  simple   simple
</pre></div>
</div>
<p>There are a lot of <strong class="command">dump</strong> subcommands available for exploring the bundle.</p>
</div>
<div class="section" id="build-the-bundles">
<h2>2.2.4. Build the Bundles<a class="headerlink" href="#build-the-bundles" title="Permalink to this headline">¶</a></h2>
<p>If that looks good, you can build the bundles. Because these bundles were created for testing, the bundles are in various states of development, so you should go through all three phases with them. These phases are:</p>
<ul class="simple">
<li><em>Ingest</em> to load the source files.</li>
<li><em>Schema</em> to create tables from the source files.</li>
<li><em>Build</em> to actually build the bundle.</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ bambry -i d000simple003 ingest
$ bambry schema
$ bambry build
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ingest</span></code> and <code class="docutils literal"><span class="pre">schema</span></code> phases  update the bundle source files, so the next time the bundle is checked out and build, you&#8217;d only need to run the <code class="docutils literal"><span class="pre">build</span></code> phase.</p>
<p>After the build is complete, the bundle list should show that the <code class="docutils literal"><span class="pre">simple</span></code> bundle has been built:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ambry list
vid            vid            vname                             state
-------------  -------------  --------------------------------  -------
d000simple003  d000simple003  example.com-simple-0.1.3          build_done
d0segments001  d0segments001  example.com-segments-0.1.1        new
d00process003  d00process003  example.com-process-0.1.3         new
dgenerator001  dgenerator001  example.com-generators-0.1.1      new
ddimension001  ddimension001  example.com-dimension-0.1.1       new
d000000ref003  d000000ref003  example.com-complete-ref-0.1.3    new
d00000load003  d00000load003  example.com-complete-load-0.1.3   new
d0000build003  d0000build003  example.com-complete-build-0.1.3  new
d00casters003  d00casters003  example.com-casters-0.1.3         new
</pre></div>
</div>
</div>
<div class="section" id="check-your-work">
<h2>2.2.5. Check your Work<a class="headerlink" href="#check-your-work" title="Permalink to this headline">¶</a></h2>
<p>You can review the build with the <strong class="command">bambry info</strong> command. With the <code class="docutils literal"><span class="pre">-P</span></code> option, it will list the data partitions, and with the <code class="docutils literal"><span class="pre">-S</span></code> option, it will display statistics:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ bambry info -P
Title    Simple Example Bundle
Summary  This is a short summary of the data bundle
VID    d000simple003             Build State  build_done
VName  example.com-simple-0.1.3
Build  FS  &lt;OSFS: /Users/eric/proj/virt/ambry10/library/build/example.com/simple-0.1.3&gt;
Source FS  &lt;OSFS: /Users/eric/proj/virt/ambry10/demo-source/example.com/simple-0.1.3&gt;

Partitions
Vid               Name                             Table    Time    Space    Grain
----------------  -------------------------------  -------  ------  -------  -------
p000simple002003  example.com-simple-simple-0.1.3  simple
</pre></div>
</div>
<p>Look in the directories specified by the <code class="docutils literal"><span class="pre">Build</span> <span class="pre">FS</span></code> URL, and you will find all of the build files, including the ingested sources, output files and pipeline output logs that describe the main stages of the build.</p>
<p>If you want to get the data in your bundle extracted to a CSV file, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ bambry extract
Using bundle ref d000simple003, referenced from <span class="nb">history</span>
INFO example.com-simple Extracting: example.com-simple-simple
INFO example.com-simple Extracted to: /Users/eric/proj/virt/ambry10/library/build/example.com/simple-0.1.3/extract
<span class="o">(</span>ambry10<span class="o">)[</span>eric@gala doc<span class="o">]</span>$ open /Users/eric/proj/virt/ambry10/library/build/example.com/simple-0.1.3/extract/example.com-simple-simple.csv
</pre></div>
</div>
<p>The files in the build directory with a <code class="docutils literal"><span class="pre">.mpr</span></code> extension is a proprietary format. You can view these files with the <strong class="command">ampr</strong> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ampr -H /Users/eric/proj/virt/ambry10/library/build/example.com/simple-0.1.3/example.com/simple-0.1.3/source/simple.mpr
MPR File    : /Users/eric/proj/virt/ambry10/library/build/example.com/simple-0.1.3/example.com/simple-0.1.3/source/simple.mpr
Created     : 2015-09-22 16:12:42.336765
version     : 1
rows        : 10001
cols        : 4
header_rows : <span class="o">[</span>0<span class="o">]</span>
data_row    : 1
end_row     : 10001
URL         : http://public.source.civicknowledge.com/example.com/sources/simple-example.csv

HEAD
  <span class="c1">#    id  uuid                                    int    float</span>
---  ----  ------------------------------------  -----  -------
  <span class="m">0</span>     <span class="m">1</span>  eb385c36-9298-4427-8925-fe09294dbd5f     <span class="m">30</span>  99.7347
  <span class="m">1</span>     <span class="m">2</span>  fbe2ba34-b130-49b7-bd84-3dc6efb63266     <span class="m">79</span>  18.7601
  <span class="m">2</span>     <span class="m">3</span>  b63c1b4c-0d48-43ae-9f1d-83b0291462b5     <span class="m">21</span>  34.2059
  <span class="m">3</span>     <span class="m">4</span>  bcf29f19-79f3-427d-b068-898e21bdc933     <span class="m">52</span>  85.1948
  <span class="m">4</span>     <span class="m">5</span>  f02d53a3-6bbc-4095-a889-c4dde0ccf577    <span class="m">100</span>  20.3416
  <span class="m">5</span>     <span class="m">6</span>  2ba85adb-4f0b-428b-b947-f4227b5b2979     <span class="m">16</span>  86.6151
  <span class="m">6</span>     <span class="m">7</span>  56f8800e-cad7-4a59-bde4-70cba84eef50     <span class="m">60</span>   4.8741
  <span class="m">7</span>     <span class="m">8</span>  58c35b80-be66-40dc-b1a4-f43a208e0acb     <span class="m">89</span>  10.9109
  <span class="m">8</span>     <span class="m">9</span>  566f968f-2f2a-4b59-9d3f-18261722e6f2     <span class="m">69</span>  97.6747
  <span class="m">9</span>    <span class="m">10</span>  d1a7fd5d-4ebb-4ef1-b9b0-d7696157aa45     <span class="m">62</span>  33.657
</pre></div>
</div>
</div>
<div class="section" id="bundle-source">
<h2>2.2.6. Bundle Source<a class="headerlink" href="#bundle-source" title="Permalink to this headline">¶</a></h2>
<p>One thing we haven&#8217;t seen yet is the source. When the sources were imported from the ambry source directory, we used the <code class="docutils literal"><span class="pre">-d</span></code> option so changes to the source files would not be written back into the ambry source directory. The imported bundle will store sources in the default location, which is specified in the <code class="docutils literal"><span class="pre">Source</span> <span class="pre">FS</span></code> url. But, that directory is empty now, because the source files have not been exported to it.</p>
<p>To export the bundle source files, run <strong class="command">bambry export</strong>. Then visit the source directory to see some of the files that were involved in making the bundle.</p>
</div>
<div class="section" id="other-tips">
<h2>2.2.7. Other Tips<a class="headerlink" href="#other-tips" title="Permalink to this headline">¶</a></h2>
<p>Make changing directories a bit easier by installing the helper functions. You can put this into your <code class="docutils literal"><span class="pre">.bashrc</span></code> so its always there:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> <span class="k">$(</span>which ambry-aliases.sh <span class="k">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../process/index.html" class="btn btn-neutral float-right" title="3. Process Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_bundle.html" class="btn btn-neutral" title="2.1. Create a New Bundle" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Civic Knowledge.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.3.2049',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>